\hypertarget{service_8cpp}{}\doxysection{src/service.cpp File Reference}
\label{service_8cpp}\index{src/service.cpp@{src/service.cpp}}


Node to manage the correct drive mode according to the user choice.  


{\ttfamily \#include \char`\"{}ros/ros.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}std\+\_\+srvs/\+Empty.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}assignment/\+Service.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}sensor\+\_\+msgs/\+Laser\+Scan.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}geometry\+\_\+msgs/\+Twist.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}stdio.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}string.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}move\+\_\+base\+\_\+msgs/\+Move\+Base\+Action\+Goal.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}geometry\+\_\+msgs/\+Point\+Stamped.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}move\+\_\+base\+\_\+msgs/\+Move\+Base\+Action\+Feedback.\+h\char`\"{}}\newline
Include dependency graph for service.\+cpp\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{service_8cpp__incl}
\end{center}
\end{figure}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{service_8cpp_a70ed59adcb4159ac551058053e649640}\label{service_8cpp_a70ed59adcb4159ac551058053e649640}} 
\#define {\bfseries S\+I\+ZE}~144
\item 
\mbox{\Hypertarget{service_8cpp_a13d252428836cb17e8183d427299d370}\label{service_8cpp_a13d252428836cb17e8183d427299d370}} 
\#define {\bfseries th}~0.\+5
\item 
\mbox{\Hypertarget{service_8cpp_ae62a5b19571be315331b379784dc04ba}\label{service_8cpp_ae62a5b19571be315331b379784dc04ba}} 
\#define {\bfseries wth}~1
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{service_8cpp_a890521a70172978804cdaf281c4b5058}{set\+Pose\+Params}} (float inX, float inY)
\begin{DoxyCompactList}\small\item\em Function to set the goal of the robot. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{service_8cpp_a6911e3fbd406f287be9ab539f0459c0a}{cancel\+Goal}} ()
\begin{DoxyCompactList}\small\item\em Function to delete the actual goal. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{service_8cpp_a60a61cb42ee062b6782bcc39a63aa3bf}{take\+Status}} (const move\+\_\+base\+\_\+msgs\+::\+Move\+Base\+Action\+Feedback\+::\+Const\+Ptr \&msg)
\begin{DoxyCompactList}\small\item\em Function to take the status\+: goal ID. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{service_8cpp_a7b3a86d9513c00df95a3019351e00061}{curr\+Goal}} (const move\+\_\+base\+\_\+msgs\+::\+Move\+Base\+Action\+Goal\+::\+Const\+Ptr \&m)
\begin{DoxyCompactList}\small\item\em Function to store the current goal the robot has to rach. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{service_8cpp_a2c38b7bf238ee6a4bd51cfe140c3d87f}{take\+Vel}} (const geometry\+\_\+msgs\+::\+Twist\+::\+Const\+Ptr \&m)
\begin{DoxyCompactList}\small\item\em Function to take the current velocity of the robot. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{service_8cpp_a2a0e843767aeea4f433a28b9c54f573a}{menu}} ()
\begin{DoxyCompactList}\small\item\em Function to display infos about how to enter a valid position for the goal the robot has to reach. \end{DoxyCompactList}\item 
double \mbox{\hyperlink{service_8cpp_ae0dfddff71559c8451ffd82cf1bb34e6}{min\+\_\+val}} (double a\mbox{[}$\,$\mbox{]})
\begin{DoxyCompactList}\small\item\em Function to compute the minimul valie among an array. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{service_8cpp_a74eeefdaefa8e5ec4b48c6209aaeb02f}{manually\+Drive}} (char input)
\begin{DoxyCompactList}\small\item\em Function to enable/disable or quit the manual drive. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{service_8cpp_ad92a1ab439081fef6e6c319e774e907f}{drive\+Assist}} (const sensor\+\_\+msgs\+::\+Laser\+Scan\+::\+Const\+Ptr \&m)
\begin{DoxyCompactList}\small\item\em Function to assit the robot while driving. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{service_8cpp_a8cdd6d065ca78e45cb762ecfcb2935e7}{set\+Drive\+Mod}} (assignment\+::\+Service\+::\+Request \&req, assignment\+::\+Service\+::\+Response \&res)
\begin{DoxyCompactList}\small\item\em Function to set the drive modality according to the user input. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{service_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{main}} (int argc, char $\ast$$\ast$argv)
\begin{DoxyCompactList}\small\item\em Main function of the node. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{service_8cpp_a1e08fee95303ef1c51d7369649b0fb1c}\label{service_8cpp_a1e08fee95303ef1c51d7369649b0fb1c}} 
bool \mbox{\hyperlink{service_8cpp_a1e08fee95303ef1c51d7369649b0fb1c}{assist\+Drive}} = false
\begin{DoxyCompactList}\small\item\em Global variable to manage the drive assistance activation. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{service_8cpp_ac3039562ceac7fca79eec81d1561b228}\label{service_8cpp_ac3039562ceac7fca79eec81d1561b228}} 
bool \mbox{\hyperlink{service_8cpp_ac3039562ceac7fca79eec81d1561b228}{manual}} = false
\begin{DoxyCompactList}\small\item\em Global variable to manage the manual drive activation. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{service_8cpp_adc50817b9a5196dce387a27280cf2c2c}\label{service_8cpp_adc50817b9a5196dce387a27280cf2c2c}} 
bool \mbox{\hyperlink{service_8cpp_adc50817b9a5196dce387a27280cf2c2c}{G}} = false
\begin{DoxyCompactList}\small\item\em Global variable to determine the presence of a goal. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{service_8cpp_a350594df3e8f6948c8462edfd41ce086}\label{service_8cpp_a350594df3e8f6948c8462edfd41ce086}} 
ros\+::\+Publisher \mbox{\hyperlink{service_8cpp_a350594df3e8f6948c8462edfd41ce086}{pub}}
\begin{DoxyCompactList}\small\item\em Defining a publisher for the goal publication. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{service_8cpp_af16f3cb6a089096b01458711b8a6eebb}\label{service_8cpp_af16f3cb6a089096b01458711b8a6eebb}} 
ros\+::\+Publisher \mbox{\hyperlink{service_8cpp_af16f3cb6a089096b01458711b8a6eebb}{pub\+Cancel}}
\begin{DoxyCompactList}\small\item\em Defining a publisher for the goal deletion. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{service_8cpp_acc3d127c97446f878d9550daf52cdb06}\label{service_8cpp_acc3d127c97446f878d9550daf52cdb06}} 
ros\+::\+Publisher \mbox{\hyperlink{service_8cpp_acc3d127c97446f878d9550daf52cdb06}{pubV}}
\begin{DoxyCompactList}\small\item\em Defining a publisher for the velocity publication. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{service_8cpp_a3d019b1517126a1fe3e5c258ffdf23b6}\label{service_8cpp_a3d019b1517126a1fe3e5c258ffdf23b6}} 
move\+\_\+base\+\_\+msgs\+::\+Move\+Base\+Action\+Goal \mbox{\hyperlink{service_8cpp_a3d019b1517126a1fe3e5c258ffdf23b6}{pose}}
\begin{DoxyCompactList}\small\item\em Global variable to store the position of the robot. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{service_8cpp_a36975d8f325eddfc16c5c17bd6116efd}\label{service_8cpp_a36975d8f325eddfc16c5c17bd6116efd}} 
std\+::string \mbox{\hyperlink{service_8cpp_a36975d8f325eddfc16c5c17bd6116efd}{goal\+ID}}
\begin{DoxyCompactList}\small\item\em Global variable to store the goal ID of the robot. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{service_8cpp_a1c985d62869c1ba5fb80c7f01dff1f0b}\label{service_8cpp_a1c985d62869c1ba5fb80c7f01dff1f0b}} 
actionlib\+\_\+msgs\+::\+Goal\+ID \mbox{\hyperlink{service_8cpp_a1c985d62869c1ba5fb80c7f01dff1f0b}{goal\+To\+Cancel}}
\begin{DoxyCompactList}\small\item\em Global variaible to store the ID of the goal that has to be deleted. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{service_8cpp_ad8b22358bb104a13cb2016985daa07eb}\label{service_8cpp_ad8b22358bb104a13cb2016985daa07eb}} 
geometry\+\_\+msgs\+::\+Twist \mbox{\hyperlink{service_8cpp_ad8b22358bb104a13cb2016985daa07eb}{n}}
\begin{DoxyCompactList}\small\item\em Global variable as message to pass data with a proper format. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{service_8cpp_add752d850860e74bb9d4b65aa31f1140}\label{service_8cpp_add752d850860e74bb9d4b65aa31f1140}} 
float \mbox{\hyperlink{service_8cpp_add752d850860e74bb9d4b65aa31f1140}{xG}}
\begin{DoxyCompactList}\small\item\em Global variable to store the x-\/coordinate of the position inserted by the user. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{service_8cpp_a93b1a89dbf18ea027073e19a2a0adbbe}\label{service_8cpp_a93b1a89dbf18ea027073e19a2a0adbbe}} 
float \mbox{\hyperlink{service_8cpp_a93b1a89dbf18ea027073e19a2a0adbbe}{yG}}
\begin{DoxyCompactList}\small\item\em Global variable to store the y-\/coordinate of the position inserted by the user. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Node to manage the correct drive mode according to the user choice. 

\begin{DoxyAuthor}{Author}
Matteo Maragliano 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+0 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
27/02/2022 
\end{DoxyDate}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{service_8cpp_a6911e3fbd406f287be9ab539f0459c0a}\label{service_8cpp_a6911e3fbd406f287be9ab539f0459c0a}} 
\index{service.cpp@{service.cpp}!cancelGoal@{cancelGoal}}
\index{cancelGoal@{cancelGoal}!service.cpp@{service.cpp}}
\doxysubsubsection{\texorpdfstring{cancelGoal()}{cancelGoal()}}
{\footnotesize\ttfamily void cancel\+Goal (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Function to delete the actual goal. 


\begin{DoxyParams}{Parameters}
{\em } & \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{service_8cpp_a7b3a86d9513c00df95a3019351e00061}\label{service_8cpp_a7b3a86d9513c00df95a3019351e00061}} 
\index{service.cpp@{service.cpp}!currGoal@{currGoal}}
\index{currGoal@{currGoal}!service.cpp@{service.cpp}}
\doxysubsubsection{\texorpdfstring{currGoal()}{currGoal()}}
{\footnotesize\ttfamily void curr\+Goal (\begin{DoxyParamCaption}\item[{const move\+\_\+base\+\_\+msgs\+::\+Move\+Base\+Action\+Goal\+::\+Const\+Ptr \&}]{m }\end{DoxyParamCaption})}



Function to store the current goal the robot has to rach. 


\begin{DoxyParams}{Parameters}
{\em m} & message from which infos regarding the robot\textquotesingle{}s position are taken\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}
The function is used to take the robot goal in order to make it available to the program to perform particular actions\+: for example the check of the distance to allow the program delete it, or also to state that a particular position (x,y) inserted is not reachable by the robot. \mbox{\Hypertarget{service_8cpp_ad92a1ab439081fef6e6c319e774e907f}\label{service_8cpp_ad92a1ab439081fef6e6c319e774e907f}} 
\index{service.cpp@{service.cpp}!driveAssist@{driveAssist}}
\index{driveAssist@{driveAssist}!service.cpp@{service.cpp}}
\doxysubsubsection{\texorpdfstring{driveAssist()}{driveAssist()}}
{\footnotesize\ttfamily void drive\+Assist (\begin{DoxyParamCaption}\item[{const sensor\+\_\+msgs\+::\+Laser\+Scan\+::\+Const\+Ptr \&}]{m }\end{DoxyParamCaption})}



Function to assit the robot while driving. 


\begin{DoxyParams}{Parameters}
{\em m} & message containing all the distances of the obstacles detected by the robot\textquotesingle{}s sensors\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}
The function is used to assist the robot while it is driving. In particular the function checks that the assist drive modality in enabled (if not it quits) then stores the distances value into an array with a proper dimension; then it divides this array into 5 sub arrays (with dimension 144) in order to have different intervals to check. Once that all the data are ready for the program, at each iteration the function checks that the distance of the minimum value of the array is greater than a threshold (choosen by the programmer and defined as a D\+E\+F\+I\+NE at the beginning of the program); if the threshold is greater then the program follows the normal flow, otherwise the function sets the linear and angular velocity to zero and publish them to stop the robot thus avoiding a collision Of course this step are computed for each sub array defined\+: the threshold may vary if choosen differently. \mbox{\Hypertarget{service_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}\label{service_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}} 
\index{service.cpp@{service.cpp}!main@{main}}
\index{main@{main}!service.cpp@{service.cpp}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$$\ast$}]{argv }\end{DoxyParamCaption})}



Main function of the node. 


\begin{DoxyParams}{Parameters}
{\em } & \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{service_8cpp_a74eeefdaefa8e5ec4b48c6209aaeb02f}\label{service_8cpp_a74eeefdaefa8e5ec4b48c6209aaeb02f}} 
\index{service.cpp@{service.cpp}!manuallyDrive@{manuallyDrive}}
\index{manuallyDrive@{manuallyDrive}!service.cpp@{service.cpp}}
\doxysubsubsection{\texorpdfstring{manuallyDrive()}{manuallyDrive()}}
{\footnotesize\ttfamily void manually\+Drive (\begin{DoxyParamCaption}\item[{char}]{input }\end{DoxyParamCaption})}



Function to enable/disable or quit the manual drive. 


\begin{DoxyParams}{Parameters}
{\em input} & char that represents the command the user has inserted\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}
The function is used to enable, disable or quit the manual drive for the robot. In particular there is a switch that takes as parameter a character inserted by the user. First of all the global variable manual is set to true to allow the user drive the robot with the keyboard; then depending on the value read it is changed the value of the global variable assist\+Drive (true when enabled, false when disabled) in order to allow the program having or not the assistance during the drive. At the end, when the user inserts the quit command (q) the function sets to false all the two global variables, sets also to 0 the linear and angular velocity of the robot and publishes them to stop the robot moving. \mbox{\Hypertarget{service_8cpp_a2a0e843767aeea4f433a28b9c54f573a}\label{service_8cpp_a2a0e843767aeea4f433a28b9c54f573a}} 
\index{service.cpp@{service.cpp}!menu@{menu}}
\index{menu@{menu}!service.cpp@{service.cpp}}
\doxysubsubsection{\texorpdfstring{menu()}{menu()}}
{\footnotesize\ttfamily void menu (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Function to display infos about how to enter a valid position for the goal the robot has to reach. 


\begin{DoxyParams}{Parameters}
{\em } & \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{service_8cpp_ae0dfddff71559c8451ffd82cf1bb34e6}\label{service_8cpp_ae0dfddff71559c8451ffd82cf1bb34e6}} 
\index{service.cpp@{service.cpp}!min\_val@{min\_val}}
\index{min\_val@{min\_val}!service.cpp@{service.cpp}}
\doxysubsubsection{\texorpdfstring{min\_val()}{min\_val()}}
{\footnotesize\ttfamily double min\+\_\+val (\begin{DoxyParamCaption}\item[{double}]{a\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})}



Function to compute the minimul valie among an array. 


\begin{DoxyParams}{Parameters}
{\em a\mbox{[}$\,$\mbox{]}} & an array of double that contains values representing the distances\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
min\+\_\+val the minimum value that is contained inside the array
\end{DoxyReturn}
The functon is used to compute the minimum value among an array with a certain dimension. In particular, each array element represents the distance from an obstacle that is detected by the laser scan. The robot is provided with 720 sensors, so the array will have that dimension (S\+I\+ZE in the function); the maximum distance that the robot can detect is 30 and this is the value that is set as the minimim inside the dist variable of the function. For each element inside of the array the function compares it with the dist variable and if it is lower that this one then it is updated with the new minimum value. At the end of the execution the function returns the minimum value. \mbox{\Hypertarget{service_8cpp_a8cdd6d065ca78e45cb762ecfcb2935e7}\label{service_8cpp_a8cdd6d065ca78e45cb762ecfcb2935e7}} 
\index{service.cpp@{service.cpp}!setDriveMod@{setDriveMod}}
\index{setDriveMod@{setDriveMod}!service.cpp@{service.cpp}}
\doxysubsubsection{\texorpdfstring{setDriveMod()}{setDriveMod()}}
{\footnotesize\ttfamily bool set\+Drive\+Mod (\begin{DoxyParamCaption}\item[{assignment\+::\+Service\+::\+Request \&}]{req,  }\item[{assignment\+::\+Service\+::\+Response \&}]{res }\end{DoxyParamCaption})}



Function to set the drive modality according to the user input. 


\begin{DoxyParams}{Parameters}
{\em req,res} & respectively the request and response of the service\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
boolean true or false
\end{DoxyReturn}
The function is used to set the drive modality according to the user input. Once the user enters an input inside the UI this is passed to the service node by a service\+: the request is used inside the switch case to set the modality. \mbox{\Hypertarget{service_8cpp_a890521a70172978804cdaf281c4b5058}\label{service_8cpp_a890521a70172978804cdaf281c4b5058}} 
\index{service.cpp@{service.cpp}!setPoseParams@{setPoseParams}}
\index{setPoseParams@{setPoseParams}!service.cpp@{service.cpp}}
\doxysubsubsection{\texorpdfstring{setPoseParams()}{setPoseParams()}}
{\footnotesize\ttfamily void set\+Pose\+Params (\begin{DoxyParamCaption}\item[{float}]{inX,  }\item[{float}]{inY }\end{DoxyParamCaption})}



Function to set the goal of the robot. 


\begin{DoxyParams}{Parameters}
{\em float} & X and Y coordinates for the goal.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}
The function takes as input the x and y value inserted by the user and set them as the target goal that the robot has to reach. It enters into the field ...position.\+x/y to set them, then sets the frame\+\_\+id as map and the value of the quaternion module to 1 (all to 0 except w to 1). After having completed all these actions it publish the goal and set the variable G (the one to establish the presence of a goal) to true so that the robot can know there is a goal to be reached. \mbox{\Hypertarget{service_8cpp_a60a61cb42ee062b6782bcc39a63aa3bf}\label{service_8cpp_a60a61cb42ee062b6782bcc39a63aa3bf}} 
\index{service.cpp@{service.cpp}!takeStatus@{takeStatus}}
\index{takeStatus@{takeStatus}!service.cpp@{service.cpp}}
\doxysubsubsection{\texorpdfstring{takeStatus()}{takeStatus()}}
{\footnotesize\ttfamily void take\+Status (\begin{DoxyParamCaption}\item[{const move\+\_\+base\+\_\+msgs\+::\+Move\+Base\+Action\+Feedback\+::\+Const\+Ptr \&}]{msg }\end{DoxyParamCaption})}



Function to take the status\+: goal ID. 


\begin{DoxyParams}{Parameters}
{\em msg} & message from which infos regarding the robot\textquotesingle{}s position are taken\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}
The function is set to keep periodically updated the current goal set\+: in particular the goal is periodically taken into a proper variable. Moreover, if there is a goal already set, checked through the variable G, and if the robot is sufficiently near the position speficied by the user input (x and y coordinates) then the goal is automatically deleted to avoid having it set even if the robot is not moving, thus saving memory space. \mbox{\Hypertarget{service_8cpp_a2c38b7bf238ee6a4bd51cfe140c3d87f}\label{service_8cpp_a2c38b7bf238ee6a4bd51cfe140c3d87f}} 
\index{service.cpp@{service.cpp}!takeVel@{takeVel}}
\index{takeVel@{takeVel}!service.cpp@{service.cpp}}
\doxysubsubsection{\texorpdfstring{takeVel()}{takeVel()}}
{\footnotesize\ttfamily void take\+Vel (\begin{DoxyParamCaption}\item[{const geometry\+\_\+msgs\+::\+Twist\+::\+Const\+Ptr \&}]{m }\end{DoxyParamCaption})}



Function to take the current velocity of the robot. 


\begin{DoxyParams}{Parameters}
{\em m} & message from which infos regarding the robot are taken\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}
The function is used to read the robot\textquotesingle{}s velocity. In particular the function checks if the manual modality of driving is enabled, throigh the manual global velocity; after that it also checks the presence of the driving assistance through a proper variable; at the end it stores the actual velocity of the robot into two different variables in order to have them available. 